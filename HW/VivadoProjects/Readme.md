# Vivado Projects for HM2 on Zynq SoCs

## The IP
There are two supporting IP components to get hostmot2 into a Zynq SoC design.

### hm2\_ip_wrap 
A simple wrapper that hides generic values that cannot be resolved by the IP 
packager at this time. It also holds template files that allow each individual 
project to specify the correct mesanet pin file (vhdl, not physical pin 
constraints). If Xilinx updates Vivado to handle user defined generics at the 
top level, this entire component can be removed, along with the pin file 
insertion cludge that happens in the make_bitfile script. Right now, these 
workarounds remove the limitation of one pinout or the necessity to hand edit 
VHDL before compiling a project.

### hm2_axilite
A hostmot2 generic 32-bit bus to axi-lite conversion shim. Although the port 
naming conventions were chosen to easily integrate with Vivado's IP packager, 
there should not be any Xilinx specific code in the source. As long as the new 
target supports axi-lite, this can probably be implemented with *minor* changes.

## The Vivado Projects
The first Vivado project is under microzed/jd2cb which is a SOM/carrier structure.
If a board is not SoM and is directly used, you can omit the carrier folder. This
was done because I have three unique carriers for the same SoM, and it looked
cleaner on disk than a flatter file structure (i.e., 1 per config).

# Building a project
Call make\_bitfile.sh from the VivadoProjects directory. The argument should be 
the path to the config file of the bitfile you want to build. Example:

```
$ ./make_bitfile.sh  microzed/microzed_jd2cb/config
```

# Making a new Vivado Project
Use the initial project as a template, keeping the correct file structure. There
are two tcl scripts that should be edited for project specific files, e.g., pin 
constraints, block diagram tcls, additional timing constraints, etc. After 
running the make\_bitfile script, the *\_created project folder will be available. 
Open the project inside this folder with Vivado GUI to poke around. If you make 
changes to the project or block diagram, reexport the relevant tcl script to a 
temporary file and work the changes in by hand. The autogenerated scripts can be 
nasty, and a hand edited ones like the samples are much nicer. You will also 
need to define the config file used by the make\_bitstream.sh script. After 
running make\_bitstream, the *.bit.bin file will be in your new root folder for 
the carrier.

Checkout the latest commit for the FZ3 board if you are adding a mpsoc based board
